# OutlineWriter - 原稿執筆特化アウトラインエディター

OutlineWriterは、Dynalistのような階層的なアウトライン機能を持ちながら、原稿執筆に特化したWebアプリケーションです。小説、論文、レポート、ブログ記事などの執筆において構造的な文章作成をサポートします。

## 特徴

- **階層的アウトライン構造**: Dynalistライクな直感的な階層管理
- **原稿執筆最適化**: 見出しと本文の明確な区別
- **多彩なインポート・エクスポート**: OPML、テキスト、Markdown対応
- **高度な編集機能**: ドラッグ&ドロップ、複数選択、マージ機能
- **リアルタイム文字数カウント**: 現在項目と全体の文字数表示
- **集中できるUI**: シンプルで気が散らないデザイン
- **完全ローカル動作**: サーバー不要、オフラインで使用可能
- **自動保存**: ローカルストレージによるデータ永続化
- **アンドゥ・リドゥ機能**: Ctrl+Z/Ctrl+Yで操作の取り消し・やり直し
- **バックアップシステム**: 自動バックアップ（5分間隔）と手動バックアップ・復元
- **カスタムファイル名**: エクスポート時にファイル名を自由に指定可能
- **レスポンシブ対応**: デスクトップ・タブレット・スマホで利用可能

## システム要件

- モダンブラウザ（Chrome, Firefox, Safari, Edge）
- JavaScript有効
- ローカルストレージ対応

## インストール・起動方法

1. 以下のファイルをダウンロード：
   - `index.html`
   - `styles.css`
   - `script.js`

2. 同一フォルダに配置

3. `index.html`をブラウザで開く
   - ファイルマネージャーからダブルクリック
   - ブラウザのアドレスバーに`file:///path/to/index.html`を入力
   - コマンドライン：`xdg-open index.html`

## 画面構成

### ヘッダー部
- **OutlineWriter**: アプリケーションタイトル
- **項目追加**: 新しいアウトライン項目を作成
- **保存**: データをローカルストレージに保存
- **操作グループ**: アンドゥ（↶）・リドゥ（↷）ボタン
- **バックアップグループ**: バックアップ作成・復元ボタン
- **読込グループ**: JSON、OPML、テキスト、Markdownファイルの読み込み
- **出力グループ**: テキスト、Markdown形式での出力（カスタムファイル名対応）
- **文字数**: 現在編集中項目と全体の文字数表示

### 左サイドバー（アウトライン）
- **全て展開/全て折り畳み**: 全項目の表示状態を一括変更
- **アウトライン項目一覧**: 階層構造で項目を表示
  - ⋮⋮: ドラッグハンドル（並び替え用）
  - ▼/▶: 子項目の展開/折り畳み
  - •: 子項目なし
  - **太字**: 見出し項目
  - 青色ハイライト: 現在選択中の項目
  - オレンジ色ハイライト: 複数選択中の項目
  - 緑色ハイライト: 選択中かつ複数選択中の項目

### 右エディター領域
- **タイトル入力欄**: 選択中項目のタイトル編集
- **見出しチェックボックス**: 項目を見出しとして設定
- **インデント/アウトデント**: 階層レベル調整
- **削除**: 選択中項目を削除
- **内容入力欄**: 項目の本文を編集

## 基本操作

### 1. 新規項目の作成
1. **位置**: 項目を選択してから「項目追加」ボタンをクリック
2. **配置**: 選択中項目の直下（同じ階層レベル）に新項目が作成される
3. **フォールバック**: 何も選択していない場合は最下位に追加
4. **自動選択**: 新項目が自動的に選択され、タイトル入力欄にフォーカス
5. **編集開始**: タイトルが自動選択され、すぐに編集可能

### 2. 項目の選択・編集
1. 左サイドバーの項目をクリックして選択
2. 右側のエディター領域で編集
3. 変更は自動的に反映される

### 3. 階層構造の操作

#### インデント（階層を下げる）
- 項目を選択して「インデント」ボタンをクリック
- 上の項目の子項目になる
- 最上位項目や、上に項目がない場合は実行不可

#### アウトデント（階層を上げる）
- 項目を選択して「アウトデント」ボタンをクリック
- 親項目と同じレベルに移動
- 最上位項目の場合は実行不可

### 4. 見出し設定
- 項目を選択
- 「見出し」チェックボックスをオン
- アウトライン上で太字・青色で表示される

### 5. 折り畳み・展開
- 子項目がある項目の「▼」「▶」をクリック
- 「全て展開」「全て折り畳み」で一括操作

### 6. 項目の削除
1. 削除したい項目を選択
2. 「削除」ボタンをクリック
3. 確認ダイアログで「OK」

### 7. 複数選択とマージ
1. **複数選択**: Ctrlキー（Mac: Cmdキー）を押しながらアウトライン項目をクリック
2. **視覚的フィードバック**: 選択項目がオレンジ色でハイライト表示
3. **マージ実行**: 選択状態で右クリック →「選択項目をマージ」
4. **条件**: 同じ親を持つ項目のみマージ可能
5. **処理**: 各項目の「タイトル + 本文」を親項目の本文末尾に統合
6. **結果**: マージされた子項目は削除され、親項目に内容が統合される

### 8. 選択範囲の切り出し
1. **テキスト選択**: 内容入力欄でテキストを選択
2. **右クリック**: 選択範囲で右クリック
3. **切り出し実行**: 「選択範囲を切り出し」をクリック
4. **結果**: 選択テキストが新しい子項目として作成される

### 9. ドラッグ&ドロップ並び替え
1. **操作**: 各項目の「⋮⋮」ハンドルをドラッグ
2. **視覚的フィードバック**: ドラッグ中は半透明表示、ドロップ先はハイライト
3. **配置**: 移動先項目の直後に挿入される
4. **階層維持**: 元の階層構造を保持しながら移動
5. **リアルタイム更新**: ドロップ後即座に表示更新

### 10. アンドゥ・リドゥ機能
1. **元に戻す**: Ctrl+Z または ↶ボタンで最後の操作を取り消し
2. **やり直し**: Ctrl+Y、Ctrl+Shift+Z または ↷ボタンで取り消した操作を再実行
3. **履歴管理**: 最大50回の操作履歴を記録
4. **対象操作**: 項目の追加・削除・編集・移動・インデント・アウトデント
5. **ボタン状態**: 利用不可時はボタンが無効化

### 11. バックアップ・復元機能
1. **手動バックアップ**: 「バックアップ」→「作成」ボタンで現在の状態を保存
2. **自動バックアップ**: 5分間隔で自動的にバックアップを作成
3. **バックアップ復元**: 「バックアップ」→「復元」ボタンで過去の状態に復元
4. **バックアップ選択**: ダイアログで復元したいバックアップのタイムスタンプを選択
5. **保存制限**: 最大10個のバックアップを保持（古いものは自動削除）

### 12. カスタムファイル名エクスポート
1. **出力実行**: 「出力」グループのボタンをクリック
2. **ファイル名入力**: 表示されるダイアログでファイル名を入力
3. **デフォルト名**: 形式に応じたデフォルトファイル名が提案される
4. **拡張子**: 自動的に適切な拡張子が付与される
5. **キャンセル**: ファイル名入力をキャンセルすると出力されない

## データ管理

### 自動保存
- 項目の編集時に自動的にローカルストレージに保存
- ブラウザを閉じても次回アクセス時にデータが復元される

### 手動保存・読込
- **保存**: 現在の状態を強制的にローカルストレージに保存
- **読込**: ローカルストレージからデータを再読み込み

### データの場所
- **メインデータ**: ブラウザのローカルストレージ（キー名: `outlinewriter-data`）
- **バックアップデータ**: ブラウザのローカルストレージ（キー名: `outlinewriter-backups`）
- JSON形式で保存

### ファイル読み込み
**対応形式:**
- **JSON**: OutlineWriter内部形式（完全復元）
- **OPML**: Dynalist等のアウトラインツール形式
- **テキスト**: `■ 見出し`、`・ 項目`形式
- **Markdown**: `# 見出し`、`- リスト`形式

**読み込み方法:**
1. 読込グループから形式を選択
2. ファイル選択ダイアログでファイルを選択
3. 自動的に変換されて読み込まれる

## 文字数カウント機能

- **現在**: 編集中項目の文字数をリアルタイム表示
- **全体**: 全項目の合計文字数を表示
- ヘッダー右側に「現在: XXX | 全体: XXX」形式で表示

## キーボードショートカット

- **Tab**: フォーカス移動
- **Enter**: テキストエリア内での改行
- **Ctrl+A**: テキスト全選択
- **Ctrl+Z**: アンドゥ（元に戻す）
- **Ctrl+Y**: リドゥ（やり直し）
- **Ctrl+Shift+Z**: リドゥ（やり直し）
- **Ctrl+クリック**: アウトライン項目の複数選択
- **Escape**: 複数選択の解除
- **右クリック**: コンテキストメニュー表示

## レスポンシブ対応

### デスクトップ
- 左右分割レイアウト
- アウトライン: 350px固定幅
- エディター: 残り領域を使用

### タブレット・スマートフォン
- 上下分割レイアウト
- アウトライン: 画面の40%
- エディター: 画面の60%
- ツールバーボタンが小さくなる

## 詳細機能説明

### 項目追加の動作詳細
**選択中項目がある場合:**
```
項目1
項目2 ← 選択中
  子項目2-1
項目3

[項目追加] 実行後:

項目1
項目2
新しい項目 ← ここに追加
  子項目2-1
項目3
```

**階層構造での動作:**
```
項目1
  子項目1-1 ← 選択中
  子項目1-2
項目2

[項目追加] 実行後:

項目1
  子項目1-1
  新しい項目 ← ここに追加
  子項目1-2
項目2
```

### マージ機能の動作詳細
**マージ可能なケース:**
```
親項目
  子項目A ← 選択
  子項目B ← 選択
  子項目C

マージ実行後:
親項目
（内容に「子項目A」と「子項目B」の内容が追加される）
  子項目C
```

**マージ不可能なケース:**
```
親項目A
  子項目A-1 ← 選択
親項目B
  子項目B-1 ← 選択

→ 異なる親を持つためマージ不可
```

## トラブルシューティング

### データが消えた場合
1. ブラウザのローカルストレージが削除された可能性
2. 「読込」ボタンでデータ復旧を試行
3. 「バックアップ」→「復元」で過去のバックアップから復旧を試行
4. ブラウザの開発者ツールでローカルストレージを確認

### 動作しない場合
1. JavaScriptが有効になっているか確認
2. ブラウザのコンソールでエラーを確認
3. ファイルが正しく配置されているか確認（同一フォルダ内）

### パフォーマンスが悪い場合
- 大量の項目（1000項目以上）では動作が重くなる場合があります
- データ量を分割するか、ブラウザの再起動をお試しください

## データ形式

保存されるデータ構造：
```json
{
  "items": [
    {
      "id": 1,
      "title": "項目タイトル",
      "content": "項目の内容",
      "isHeading": false,
      "children": [],
      "expanded": true,
      "parentId": null
    }
  ],
  "nextId": 2
}
```

## 実装済み高度機能

### 1. 項目追加の最適化
- **コンテキスト追加**: 選択中項目の直下に新項目を配置
- **直感的配置**: 思考の流れを妨げない自然な位置決定
- **自動フォーカス**: 新項目作成後即座に編集開始可能

### 2. 複数選択・マージ機能
- **Ctrl+クリック選択**: 複数項目の同時選択
- **視覚的識別**: 色分けによる選択状態の明確化
- **インテリジェントマージ**: 同一親項目での統合処理
- **階層構造保持**: 文書構造を崩さない統合

### 3. ドラッグ&ドロップ並び替え
- **直感的操作**: マウスによる自然な並び替え
- **視覚フィードバック**: ドラッグ中の状態表示
- **精密配置**: 指定位置への正確な移動
- **階層維持**: 構造を保持した再配置

### 4. 選択範囲切り出し
- **部分抽出**: テキストの一部を独立項目化
- **コンテキストメニュー**: 右クリックからの簡単実行
- **自動階層化**: 適切な親子関係の自動設定
- **構造最適化**: 文書構造の自動調整

### 5. 多形式インポート・エクスポート
- **OPML対応**: Dynalist等との完全互換
- **Markdown連携**: 標準的な文書形式との相互変換
- **テキスト出力**: シンプルな階層テキスト出力
- **JSON保存**: アプリケーション固有形式での完全保存

### 6. 高度編集機能
- **全体文字数管理**: 現在項目と全体の文字数同時表示
- **見出し自動判定**: 子項目追加時の親項目見出し化
- **展開状態記憶**: 項目の表示状態永続化
- **自動保存**: 編集内容のリアルタイム保存

## 開発ロードマップ

### 短期計画（v2.3）
- **検索・置換機能**: 全項目対象の高速検索
- **フォルダ機能**: 大規模プロジェクトの整理
- **テンプレート機能**: よく使う構造の保存・呼び出し

### 中期計画（v3.0）
- **協業機能**: リアルタイム共有編集
- **バージョン管理**: 変更履歴の追跡・復元
- **プラグインシステム**: 機能拡張の柔軟性向上

### 長期計画（v4.0）
- **AI支援機能**: 構造提案・内容補完
- **クラウド連携**: オンラインストレージ対応
- **モバイルアプリ**: ネイティブアプリ版開発

### 継続改善
- **パフォーマンス最適化**: 大容量文書対応
- **UI/UX改善**: ユーザビリティ向上
- **アクセシビリティ**: より多くのユーザーへの対応

## ライセンス

このソフトウェアは自由に使用・改変・配布していただけます。

---

**OutlineWriter v2.2**  
原稿執筆のための高機能階層的アウトラインエディター

### バージョン履歴
- **v1.0**: 基本的なアウトライン機能、文字数カウント
- **v2.0**: 複数選択・マージ、ドラッグ&ドロップ、多形式I/O、選択範囲切り出し機能追加
- **v2.1**: 項目追加最適化、選択中項目の直下配置機能追加
- **v2.2**: アンドゥ・リドゥ機能、バックアップシステム、カスタムファイル名エクスポート機能追加

### 技術仕様
- **フロントエンド**: HTML5, CSS3, Vanilla JavaScript
- **データ形式**: JSON（内部）、OPML、Markdown、テキスト（I/O）
- **ストレージ**: Browser LocalStorage
- **対応ブラウザ**: Chrome 80+, Firefox 75+, Safari 13+, Edge 80+
- **パフォーマンス**: 1000項目まで快適動作を保証

### アクセシビリティ
- **キーボード操作**: 主要機能のキーボードサポート
- **視覚的フィードバック**: 色分けによる状態表示
- **直感的UI**: アイコンとテキストの併用
- **レスポンシブ**: デバイスサイズ自動対応